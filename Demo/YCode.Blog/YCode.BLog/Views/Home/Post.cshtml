@model YCode.BLog.Models.BlogPost

@{
    ViewData["Title"] = Model.Title + " - YCode Blog";
}

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/">首页</a></li>
                    @if (!string.IsNullOrEmpty(Model.Category))
                    {
                        <li class="breadcrumb-item"><a href="/?category=@Model.Category">@Model.Category</a></li>
                    }
                    <li class="breadcrumb-item active">@Model.Title</li>
                </ol>
            </nav>

            <article class="blog-post">
                <header class="mb-4">
                    <h1 class="display-5 fw-bold">@Model.Title</h1>
                    <div class="post-meta mb-4">
                        <i class="fas fa-user me-1"></i>@Model.Author
                        <i class="fas fa-calendar ms-3 me-1"></i>@Model.CreatedAt.ToString("yyyy-MM-dd HH:mm")
                        @if (Model.UpdatedAt.HasValue)
                        {
                            <i class="fas fa-edit ms-3 me-1"></i>@Model.UpdatedAt.Value.ToString("yyyy-MM-dd HH:mm")
                        }
                        <i class="fas fa-eye ms-3 me-1"></i>@Model.ViewCount 阅读
                        @if (!string.IsNullOrEmpty(Model.Category))
                        {
                            <a href="/?category=@Model.Category" class="badge bg-primary ms-3 text-decoration-none">@Model.Category</a>
                        }
                    </div>
                    <div class="mb-4">
                        @foreach (var tag in Model.Tags)
                        {
                            <a href="/?tag=@tag" class="badge bg-secondary tag-badge text-decoration-none">
                                <i class="fas fa-tag me-1"></i>@tag
                            </a>
                        }
                    </div>
                </header>

                <div class="post-content">
                    @Html.Raw(Model.Content.Replace("\n", "<br>"))
                </div>

                <footer class="mt-5 pt-4 border-top">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <small class="text-muted">
                                最后更新: @(Model.UpdatedAt?.ToString("yyyy-MM-dd HH:mm") ?? Model.CreatedAt.ToString("yyyy-MM-dd HH:mm"))
                            </small>
                        </div>
                        <div>
                            <button class="btn btn-outline-secondary btn-sm" onclick="sharePost()">
                                <i class="fas fa-share-alt me-1"></i>分享
                            </button>
                        </div>
                    </div>
                </footer>
            </article>

            <!-- 相关文章 -->
            @if (ViewBag.RelatedPosts != null && ((List<YCode.BLog.Models.BlogPost>)ViewBag.RelatedPosts).Any())
            {
                <div class="mt-5">
                    <h4 class="mb-4">相关文章</h4>
                    <div class="row">
                        @foreach (var relatedPost in ViewBag.RelatedPosts)
                        {
                            <div class="col-md-4 mb-3">
                                <div class="card h-100">
                                    <div class="card-body">
                                        <h6 class="card-title">
                                            <a href="/Home/Post/@relatedPost.Id" class="text-decoration-none">
                                                @relatedPost.Title
                                            </a>
                                        </h6>
                                        <small class="text-muted">
                                            @relatedPost.CreatedAt.ToString("yyyy-MM-dd")
                                        </small>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            }
        </div>

        <div class="col-lg-4">
            <!-- 文章信息 -->
            <div class="sidebar-widget">
                <h5><i class="fas fa-info-circle me-2"></i>文章信息</h5>
                <ul class="list-unstyled">
                    <li><strong>作者:</strong> @Model.Author</li>
                    <li><strong>发布时间:</strong> @Model.CreatedAt.ToString("yyyy-MM-dd HH:mm")</li>
                    <li><strong>阅读量:</strong> @Model.ViewCount</li>
                    @if (!string.IsNullOrEmpty(Model.Category))
                    {
                        <li><strong>分类:</strong> <a href="/?category=@Model.Category">@Model.Category</a></li>
                    }
                </ul>
            </div>

            <!-- 标签 -->
            <div class="sidebar-widget">
                <h5><i class="fas fa-tags me-2"></i>标签</h5>
                <div>
                    @foreach (var tag in Model.Tags)
                    {
                        <a href="/?tag=@tag" class="badge bg-light text-dark tag-badge text-decoration-none">
                            @tag
                        </a>
                    }
                </div>
            </div>

            <!-- 导航 -->
            <div class="sidebar-widget">
                <h5><i class="fas fa-compass me-2"></i>快速导航</h5>
                <div class="d-grid gap-2">
                    <a href="/" class="btn btn-outline-primary">
                        <i class="fas fa-home me-2"></i>返回首页
                    </a>
                    @if (!string.IsNullOrEmpty(Model.Category))
                    {
                        <a href="/?category=@Model.Category" class="btn btn-outline-secondary">
                            <i class="fas fa-folder me-2"></i>更多 @Model.Category 文章
                        </a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        function sharePost() {
            if (navigator.share) {
                navigator.share({
                    title: '@Model.Title',
                    text: '@(string.IsNullOrEmpty(Model.Summary) ? Model.Content.Substring(0, Math.Min(100, Model.Content.Length)) : Model.Summary)',
                    url: window.location.href
                });
            } else {
                // Fallback: copy to clipboard
                navigator.clipboard.writeText(window.location.href).then(function() {
                    alert('链接已复制到剪贴板！');
                });
            }
        }
    </script>
}